ğŸ” HERBALTRACE SYSTEM ANALYSIS - FARMER & LAB DATA FLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ EXECUTIVE SUMMARY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… FARMER SIDE: COMPLETE & WORKING
âŒ LAB SIDE: BLOCKED - Blockchain network peers are DOWN

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸŒ¾ FARMER SIDE - STATUS: âœ… COMPLETE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ… Collection Data Submitted:
   - Collection ID: COL-1764969995371-eae0d521
   - Farmer: farmer-1764895975875-zhil
   - Species: Tulsi
   - Quantity: 5.5 kg
   - Harvest Date: 2025-11-20
   - Created: 2025-12-05 21:26:35
   - Status: SYNCED âœ…

âœ… Blockchain Sync Complete:
   - Sync Status: synced
   - Blockchain TX ID: 9b775b704479fee9eba04cb8799f92859ad80bfc3aae6c15f798246e1ac1d33d
   - This data IS ON the blockchain

âœ… Batch Created from Collection:
   - Batch Number: BATCH-TULSI-20251207-8453
   - Species: Tulsi
   - Total Quantity: 5.5 kg
   - Status: quality_tested
   - Collections in batch: 1
   - Created: 2025-12-07 10:48:10

âš ï¸  Batch Blockchain Sync:
   - Batch blockchain TX: NOT synced
   - NOTE: The underlying collection IS synced, so data is traceable
   - Batch metadata just not yet on blockchain

ğŸ¯ FARMER SIDE CONCLUSION:
   The farmer has successfully:
   1. âœ… Collected Tulsi herbs (5.5 kg)
   2. âœ… Submitted collection data to system
   3. âœ… Data synced to blockchain (TX: 9b775b70...)
   4. âœ… Collection added to batch BATCH-TULSI-20251207-8453
   
   FARMER SIDE IS 100% COMPLETE AND WORKING!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ§ª LAB SIDE - STATUS: âŒ BLOCKED
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âŒ PROBLEM 1: Blockchain Network Peers Not Running
   
   Current Status:
   - peer0.farmers.herbaltrace.com     â†’ Exited (2) 51 minutes ago
   - peer1.farmers.herbaltrace.com     â†’ Exited (2) 51 minutes ago
   - peer0.labs.herbaltrace.com        â†’ Exited (2) 3 minutes ago
   - peer1.labs.herbaltrace.com        â†’ Exited (2) 3 minutes ago
   - peer0.processors.herbaltrace.com  â†’ Exited (2) 51 minutes ago
   - peer1.processors.herbaltrace.com  â†’ Exited (2) 51 minutes ago
   - peer0.manufacturers.herbaltrace.com â†’ Exited (2) 51 minutes ago
   - peer1.manufacturers.herbaltrace.com â†’ Exited (2) 51 minutes ago
   
   Exit Code: 2 = Configuration Error or Dependency Failure
   
   Impact:
   - No blockchain transactions can be submitted
   - QC test results cannot be synced to blockchain
   - System cannot verify or update blockchain data

âŒ PROBLEM 2: QC Test Blockchain Sync Failed
   
   Test Results in Database:
   - Test 1: QCT-1765130082262-CKAZT7 (2025-12-07)
     Status: failed
     Error: "No valid responses from any peers"
     
   - Test 2: QCT-1765130083684-CC9STK (2025-12-07)
     Status: failed
     Error: "No valid responses from any peers"
     
   - Test 3: QCT-1765131077452-RQFUJS (2025-12-07)
     Status: failed
     Error: "No valid responses from any peers"
   
   Root Cause: Peers are not running, so no endorsement possible

âœ… WHAT'S WORKING ON LAB SIDE:
   - Lab user identity enrolled âœ… (lab-1765099544540-5h9e)
   - Lab can login to system âœ…
   - Lab can see batches âœ… (BATCH-TULSI-20251207-8453 visible)
   - Lab can submit test results âœ… (3 tests submitted)
   - Test data saved to database âœ…
   - Lab user has wallet identity âœ…
   - Connection profiles configured âœ…

âŒ WHAT'S NOT WORKING ON LAB SIDE:
   - Blockchain network peers not running âŒ
   - QC tests not synced to blockchain âŒ
   - Cannot submit blockchain transactions âŒ
   - Auto-sync scheduler failing âŒ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” ROOT CAUSE ANALYSIS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

The ONLY blocker is:
   ALL HYPERLEDGER FABRIC PEER NODES ARE DOWN (Exit Code 2)

Why peers failed (common causes):
   1. CouchDB containers not running/accessible
   2. Certificate/crypto material issues
   3. Orderer connectivity problems
   4. Configuration file errors
   5. Port conflicts
   6. Insufficient system resources

Evidence of peer failure:
   Error message: "No valid responses from any peers"
   This means:
   - Gateway connects successfully âœ…
   - Identity authenticated âœ…
   - But NO peers available to endorse transactions âŒ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š DATA FLOW SUMMARY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

CURRENT STATE:

   Farmer â†’ Collection â†’ Blockchain âœ…
              â†“
           Batch â†’ (NOT on blockchain yet)
              â†“
           Lab â†’ QC Tests â†’ Database âœ…
                           â†“
                    Blockchain âŒ BLOCKED

WHAT SHOULD HAPPEN:

   Farmer â†’ Collection â†’ Blockchain âœ…
              â†“
           Batch â†’ Blockchain (batch metadata)
              â†“
           Lab â†’ QC Tests â†’ Database âœ…
                           â†“
                    Blockchain âœ… (QC results)

WHAT'S MISSING:
   - Batch blockchain sync (lower priority)
   - QC test blockchain sync (HIGH priority) â† BLOCKED BY PEER FAILURE

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”§ REQUIRED FIXES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

FIX #1: START BLOCKCHAIN PEER NODES (CRITICAL)
   
   Action Required:
   1. Check why peers are failing (look at logs)
   2. Start CouchDB containers if not running
   3. Restart peer containers
   4. Verify peers connect to orderers
   5. Ensure chaincode is installed and instantiated

   Commands to try:
   ```
   # Check CouchDB status
   docker ps | Select-String "couchdb"
   
   # Check peer logs
   docker logs peer0.labs.herbaltrace.com
   
   # Restart network
   cd D:\Trial\HerbalTrace\network
   bash deploy-network.sh restart
   
   # Or manually start peers
   docker start peer0.labs.herbaltrace.com
   docker start peer1.labs.herbaltrace.com
   ```

FIX #2: SYNC PENDING QC TESTS (After Fix #1)
   
   Once peers are running:
   ```
   cd D:\Trial\HerbalTrace\backend
   node sync-pending-tests.js
   ```
   
   This will:
   - Pick up the 3 failed tests
   - Retry blockchain submission
   - Update sync_status to 'synced'
   - Add blockchain_tx_id

FIX #3: VERIFY BATCH SYNC (Optional)
   
   Create script to sync batch metadata to blockchain

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… GOOD NEWS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Farmer side is 100% working
2. Farmer collection data IS on blockchain
3. Lab can see the batch data (because it's in the database)
4. Lab can submit test results (saves to database)
5. All identities are enrolled
6. All connection profiles are configured
7. The ONLY issue is peer containers are down

Once peers are restarted, everything will work!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Œ IMMEDIATE NEXT STEPS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

STEP 1: Check CouchDB containers
   docker ps | Select-String "couchdb"

STEP 2: Check peer logs to see why they exited
   docker logs peer0.labs.herbaltrace.com 2>&1 | Select-Object -Last 50

STEP 3: Restart the Fabric network
   cd D:\Trial\HerbalTrace\network
   bash deploy-network.sh restart

STEP 4: Verify peers are running
   docker ps | Select-String "peer"

STEP 5: Retry QC test sync
   cd D:\Trial\HerbalTrace\backend
   node sync-pending-tests.js

STEP 6: Verify success
   node check-batch-sync.js

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ FINAL STATUS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

FARMER SIDE: âœ… 100% WORKING
   - Data submitted âœ…
   - Blockchain synced âœ…
   - Batch created âœ…
   - No errors âœ…

LAB SIDE: âš ï¸ 80% WORKING, 20% BLOCKED
   - UI working âœ…
   - Batch visible âœ…
   - Test submission working âœ…
   - Data saved to DB âœ…
   - Identity enrolled âœ…
   - Blockchain sync BLOCKED âŒ (peers down)

BLOCKER: Peer containers not running (Exit Code 2)
SOLUTION: Restart Hyperledger Fabric peer nodes
EFFORT: 5-10 minutes to diagnose and fix

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
